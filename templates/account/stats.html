{% extends 'base.html' %}

{% block content %}
    <h1 class="display-5 text-center mt-3" id="block-page_header">
        Личная статистика
    </h1>



    <div class="row row-cols-1 row-cols-sm-1 row-cols-md-1 row-cols-lg-2 row-cols-xxl-4 mx-3 mt-2 mb-3 g-3 px-xxl-5" id="list-content">
        <!-- Первый столбик -->
        <div class="col">
            <div class="row row-cols-1 g-3">
                <div class="col">
                    <div class="card text-center shadow">
                        <div class="card-body">
                            <p class="fs-4">Я посетил</p>
                            <h1>{{ cities.number_of_visited_cities }}</h1>
                            <p class="fs-4">городов</p>
                        </div>
                    </div>
                </div>

                <div class="col">
                    <div class="card text-center shadow" id="section-city_{{ forloop.counter }}">
                        <div class="card-body">
                            <p class="fs-4">Города России</p>
                            <canvas class="vert" id="chart__qty_of_cities"></canvas>
                        </div>
                    </div>
                </div>
            </div>
        </div>
        <!-- ^^^ Первый столбик -->

        <!-- Второй столбик -->
        <div class="col">
            <div class="row row-cols-1 g-3">
                <div class="col">
                    <div class="card text-center shadow">
                        <div class="card-body">
                            <p class="fs-4">Осталось</p>
                            <h1>{{ cities.number_of_not_visited_cities }}</h1>
                            <p class="fs-4">городов</p>
                        </div>
                    </div>
                </div>

                <div class="col">
                    <div class="card text-center shadow">
                        <div class="card-body">
                            <p class="fs-4">В этом году</p>
                            <h1>{{ cities.number_of_visited_cities_current_year }}</h1>
                            <p class="fs-4">городов</p>
                        </div>
                    </div>
                </div>

                <div class="col">
                    <div class="card text-center shadow">
                        <div class="card-body">
                            <p class="fs-4">В прошлом году</p>
                            <h1>{{ cities.number_of_visited_cities_previoous_year }}</h1>
                            <p class="fs-4">городов</p>
                        </div>
                    </div>
                </div>
            </div>
        </div>
        <!-- ^^^ Второй столбик -->

        <!-- Третий столбик -->
        <div class="col">
            <div class="row row-cols-1 g-3">
                <div class="col">
                    <div class="card text-center shadow" id="section-city_{{ forloop.counter }}">
                        <div class="card-body">
                            <p class="fs-4">Регионы России</p>
                            <canvas id="chart__qty_of_regions" height="50px"></canvas>
                        </div>
                    </div>
                </div>

                <div class="col">
                    <div class="card text-center shadow">
                        <div class="card-body">
                            <p class="fs-4">Я был в</p>
                            <h1>{{ regions.num_visited }}</h1>
                            <p class="fs-4">регионе</p>
                        </div>
                    </div>
                </div>
            </div>
        </div>
        <!-- ^^^ Третий столбик -->

        <!-- Четвёртый столбик -->
        <div class="col">
            <div class="row row-cols-1 g-3">
                <div class="col">
                    <div class="card text-center shadow">
                        <div class="card-body">
                            <p class="fs-4">Осталось</p>
                            <h1>{{ regions.num_not_visited }}</h1>
                            <p class="fs-4">регионов</p>
                        </div>
                    </div>
                </div>

                <div class="col">
                    <div class="card text-center shadow">
                        <div class="card-body">
                            <p class="fs-4">Посещено полностью</p>
                            <h1>{{ regions.num_finished }}</h1>
                            <p class="fs-4">регионов</p>
                        </div>
                    </div>
                </div>

                <div class="col">
                    <div class="card text-center shadow">
                        <div class="card-body">
                            <p class="fs-4">???</p>
                            <h1>???</h1>
                            <p class="fs-4">???</p>
                        </div>
                    </div>
                </div>
            </div>
        </div>
        <!-- ^^^ Четвёртый столбик -->
    </div>

    <div class="row mx-3 mt-2 mb-3 g-3 px-xxl-5">
        <div class="col">
            <div class="card text-center shadow">
                <div class="card-body">
                    <p class="fs-4">Количество посещённых городов по месяцам</p>
                    <canvas id="chart__cities_by_month"></canvas>
                </div>
            </div>
        </div>

        <div class="col">
            <div class="card text-center shadow">
                <div class="card-body">
                    <p class="fs-4">Количество посещённых городов по годам</p>
                    <canvas id="chart__cities_by_year"></canvas>
                </div>
            </div>
        </div>
    </div>

    <div class="row mx-3 mt-2 mb-3 g-3 px-xxl-5" id="list-content">
        <div class="col-xl-4 order-last order-xl-first">
            {% include 'account/stats__cities.html' %}
        </div>

        <div class="col-xl-4 order-last order-xl-first">
            {% include 'account/stats__regions.html' %}
        </div>

        <div class="col-xl-4 order-last order-xl-first">
            {% include 'account/stats__areas.html' %}
        </div>
    </div>

    <script>
        const ctx_cities = document.getElementById('chart__qty_of_cities').getContext('2d');
        const ctx_regions = document.getElementById('chart__qty_of_regions').getContext('2d');
        const ctx_cities_by_month = document.getElementById('chart__cities_by_month').getContext('2d');
        const ctx_cities_by_year = document.getElementById('chart__cities_by_year').getContext('2d');

        // График посещённых городов
        const myChart_cities = new Chart(ctx_cities, {
            type: 'pie',
            data: {
                labels: ['Посещённые', 'Не посещённые'],
                datasets: [
                    {
                        data: ['{{ cities.number_of_visited_cities }}', '{{ cities.number_of_not_visited_cities }}'],
                        borderColor: ['rgba(255, 255, 255)', 'rgba(255, 255, 255)'],
                        backgroundColor: ['rgba(255,86,86,0.6)', 'rgba(255,86,86,0.3)']
                    },
                ]
            }
        });

        // График посещённых регионов
        const myChart_regions = new Chart(ctx_regions, {
            type: 'pie',
            data: {
                labels: ['Посещённые', 'Не посещённые'],
                datasets: [
                    {
                        data: ['{{ regions.num_visited }}', '{{ regions.num_not_visited }}'],
                        borderColor: ['rgba(255, 255, 255)', 'rgba(255, 255, 255)'],
                        backgroundColor: ['rgba(66, 189, 53, 0.6)', 'rgba(66, 189, 53, 0.3)']
                    },
                ],
            }
        });

        // График посещённых городов по месяцам
        let data_month = {}
        {% for month in cities.qty_cities_by_month reversed %}
            data_month['{{ month.month_year|date:'m Y' }}'] = '{{ month.qty }}'
        {% endfor %}

        new Chart(ctx_cities_by_month, {
            type: 'bar',
            data: {
                labels: Object.keys(data_month),
                datasets: [
                    {
                        label: 'Посещено городов в этом месяце',
                        data: Object.values(data_month),
                        borderColor: 'rgba(51,171,255,0.5)',
                        backgroundColor: 'rgba(51,171,255,0.2)',
                        borderWidth: 2,
                        borderRadius: 5,
                        borderSkipped: false
                    },
                ],
            }
        });

         // График посещённых городов по годам
        let data_year = {}
        {% for year in cities.qty_cities_by_year %}
            data_year['{{ year.year|date:'Y' }}'] = '{{ year.qty }}'
        {% endfor %}

        new Chart(ctx_cities_by_year, {
            type: 'bar',
            data: {
                labels: Object.keys(data_year),
                datasets: [
                    {
                        label: 'Посещено городов в этом году',
                        data: Object.values(data_year),
                        borderColor: 'rgba(193,70,255,0.5)',
                        backgroundColor: 'rgba(193,70,255,0.2)',
                        borderWidth: 2,
                        borderRadius: 5,
                        borderSkipped: false
                    },
                ],
            }
        });
    </script>
{% endblock %}