{% load morphology %}
{% load vite %}
{% load static %}
{% load filters %}

{% vite_css 'css/components/badge' %}
{% vite_css 'css/components/button' %}
{% vite_css 'css/components/radio' %}
{% vite_css 'css/toolbar' %}

<!-- Панель инструментов -->
<div class="mx-3 my-3 flex flex-wrap items-center gap-3" id="toolbar">
    <!-- Статистика -->
    <div class="toolbar-stats flex flex-wrap items-center gap-3 self-center">
        <div class="hs-tooltip [--placement:top] relative inline-block">
            <span class="hs-tooltip-toggle stat-badge stat-badge-success">
                <span class="stat-badge-dot"></span>
                {% if user.is_authenticated %}
                    Посещено: {{ number_of_visited_cities }} {{ "город"|plural_by_num:number_of_visited_cities }} из {{ number_of_cities }}
                {% else %}
                    Зарегистрируйтесь, чтобы отмечать регионы
                {% endif %}
            </span>
            <span class="hs-tooltip-content" role="tooltip">
                {% if user.is_authenticated %}
                    Количество посещённых городов в регионе
                {% else %}
                    Зарегистрируйтесь, чтобы отмечать посещённые города
                {% endif %}
            </span>
        </div>
    </div>

    <!-- Кнопки действий -->
    <div class="toolbar-actions ml-auto flex flex-wrap items-center justify-end gap-3 self-center">
        <div class="hs-tooltip [--placement:top] relative inline-block self-center">
            <a href="{% url 'region-selected-map' region_id %}" 
               class="hs-tooltip-toggle inline-flex items-center gap-x-2 rounded-xl border border-emerald-500 px-4 py-2 text-sm font-semibold text-emerald-600 transition hover:bg-emerald-50 focus:outline-none focus:ring-2 focus:ring-emerald-500 focus:ring-offset-2 dark:border-emerald-400 dark:text-emerald-300 dark:hover:bg-emerald-500/10">
                <i class="fa-solid fa-map-location-dot"></i>
                <span>Посмотреть на карте</span>
            </a>
            <span class="hs-tooltip-content" role="tooltip">
                Посмотреть города региона на карте
            </span>
        </div>

        {% if user.is_authenticated %}
            <div class="hs-tooltip [--placement:top] relative inline-block self-center">
                <button class="hs-tooltip-toggle relative inline-flex items-center gap-x-2 rounded-xl px-4 py-2 text-sm font-semibold focus:outline-none focus:ring-2 focus:ring-blue-500 focus:ring-offset-2 transition dark:focus:ring-offset-neutral-900 {% if filter is not None or sort is not None and sort != 'last_visit_date_down' %}border border-transparent bg-blue-600 text-white hover:bg-blue-700 dark:bg-blue-500 dark:hover:bg-blue-400{% else %}border border-blue-600 text-blue-600 hover:bg-blue-50 dark:text-blue-400 dark:border-blue-500 dark:hover:bg-blue-500/10{% endif %}"
                        type="button"
                        id="btnOpenFilterSortPanel"
                        data-hs-overlay="#offcanvasRight">
                    <i class="fa-solid fa-sliders"></i>
                    <span>Фильтры и сортировка</span>
                    {% if filter is not None or sort is not None and sort != 'last_visit_date_down' %}
                        <span class="absolute -right-1.5 -top-1.5 inline-flex h-2.5 w-2.5 rounded-full bg-red-500 ring-2 ring-white dark:ring-neutral-900">
                            <span class="sr-only">Применена фильтрация или сортировка</span>
                        </span>
                    {% endif %}
                </button>
                <span class="hs-tooltip-content" role="tooltip">
                    Открыть панель фильтрации и сортировки городов
                </span>
            </div>
        {% endif %}
    </div>
</div>
<!-- ^^^ Панель инструментов -->

{% if user.is_authenticated %}
{% with defaultFilter='no_filter' defaultSort='last_visit_date_down' %}
<!-- Backdrop -->
<div class="hs-overlay-backdrop hs-overlay-backdrop-open:opacity-100 hs-overlay-backdrop-open:pointer-events-auto opacity-0 pointer-events-none fixed inset-0 z-[1060] bg-gray-900/50 transition" data-hs-overlay-backdrop="#offcanvasRight"></div>

<div id="offcanvasRight" class="fixed top-0 right-0 translate-x-full transition-transform duration-300 h-full max-w-xs w-full z-[1070] bg-white border-s border-gray-200 dark:bg-neutral-800 dark:border-neutral-700 flex flex-col" tabindex="-1">
    <div class="flex justify-between items-center py-3 px-4 border-b border-gray-200 dark:border-neutral-700 shrink-0">
        <h3 class="font-bold text-gray-800 dark:text-neutral-200">
            Фильтрация и сортировка
        </h3>
        <button type="button" class="flex justify-center items-center size-7 text-sm font-semibold rounded-full border border-transparent text-gray-800 hover:bg-gray-100 disabled:opacity-50 disabled:pointer-events-none dark:text-neutral-200 dark:hover:bg-neutral-700 dark:focus:outline-none dark:focus:ring-1 dark:focus:ring-gray-600" data-hs-overlay="#offcanvasRight">
            <span class="sr-only">Закрыть</span>
            <svg class="flex-shrink-0 size-4" xmlns="http://www.w3.org/2000/svg" width="24" height="24" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2" stroke-linecap="round" stroke-linejoin="round">
                <path d="m18 6-12 12"></path>
                <path d="m6 6 12 12"></path>
            </svg>
        </button>
    </div>
    <div class="flex-1 overflow-y-auto p-4">
        <h6 class="text-sm font-semibold text-gray-800 dark:text-neutral-200 mb-3">Фильтры</h6>

        <div class="flex items-center mb-3">
            <input class="shrink-0 mt-0.5 border-gray-200 rounded-full text-blue-600 focus:ring-blue-500 disabled:opacity-50 disabled:pointer-events-none dark:bg-neutral-800 dark:border-neutral-700 dark:checked:bg-blue-500 dark:checked:border-blue-500 dark:focus:ring-offset-gray-800" type="radio" name="filter" value="no_filter" {% if filter is None or not filter|in_list:"no_magnet,magnet,current_year,last_year,visited,not_visited" %}checked{% endif %} id="filterNoFilter">
            <label for="filterNoFilter" class="text-sm text-gray-800 ms-2 dark:text-neutral-200 cursor-pointer">
                Без фильтрации
            </label>
        </div>

        <div class="flex items-center mb-3">
            <input class="shrink-0 mt-0.5 border-gray-200 rounded-full text-blue-600 focus:ring-blue-500 disabled:opacity-50 disabled:pointer-events-none dark:bg-neutral-800 dark:border-neutral-700 dark:checked:bg-blue-500 dark:checked:border-blue-500 dark:focus:ring-offset-gray-800" type="radio" name="filter" value="no_magnet" {% if filter == 'no_magnet' %}checked{% endif %} id="filterNoMagnet">
            <label for="filterNoMagnet" class="text-sm text-gray-800 ms-2 dark:text-neutral-200 cursor-pointer">
                Без сувенира
            </label>
        </div>

        <div class="flex items-center mb-3">
            <input class="shrink-0 mt-0.5 border-gray-200 rounded-full text-blue-600 focus:ring-blue-500 disabled:opacity-50 disabled:pointer-events-none dark:bg-neutral-800 dark:border-neutral-700 dark:checked:bg-blue-500 dark:checked:border-blue-500 dark:focus:ring-offset-gray-800" type="radio" name="filter" value="magnet" {% if filter == 'magnet' %}checked{% endif %} id="filterMagnet">
            <label for="filterMagnet" class="text-sm text-gray-800 ms-2 dark:text-neutral-200 cursor-pointer">
                С сувениром
            </label>
        </div>

        <div class="flex items-center mb-3">
            <input class="shrink-0 mt-0.5 border-gray-200 rounded-full text-blue-600 focus:ring-blue-500 disabled:opacity-50 disabled:pointer-events-none dark:bg-neutral-800 dark:border-neutral-700 dark:checked:bg-blue-500 dark:checked:border-blue-500 dark:focus:ring-offset-gray-800" type="radio" name="filter" value="current_year" {% if filter == 'current_year' %}checked{% endif %} id="filterCurrentYear">
            <label for="filterCurrentYear" class="text-sm text-gray-800 ms-2 dark:text-neutral-200 cursor-pointer">
                В этом году
            </label>
        </div>

        <div class="flex items-center mb-3">
            <input class="shrink-0 mt-0.5 border-gray-200 rounded-full text-blue-600 focus:ring-blue-500 disabled:opacity-50 disabled:pointer-events-none dark:bg-neutral-800 dark:border-neutral-700 dark:checked:bg-blue-500 dark:checked:border-blue-500 dark:focus:ring-offset-gray-800" type="radio" name="filter" value="last_year" {% if filter == 'last_year' %}checked{% endif %} id="filterLastYear">
            <label for="filterLastYear" class="text-sm text-gray-800 ms-2 dark:text-neutral-200 cursor-pointer">
                В прошлом году
            </label>
        </div>

        <div class="flex items-center mb-3">
            <input class="shrink-0 mt-0.5 border-gray-200 rounded-full text-blue-600 focus:ring-blue-500 disabled:opacity-50 disabled:pointer-events-none dark:bg-neutral-800 dark:border-neutral-700 dark:checked:bg-blue-500 dark:checked:border-blue-500 dark:focus:ring-offset-gray-800" type="radio" name="filter" value="visited" {% if filter == 'visited' %}checked{% endif %} id="filterVisited">
            <label for="filterVisited" class="text-sm text-gray-800 ms-2 dark:text-neutral-200 cursor-pointer">
                Посещённые
            </label>
        </div>

        <div class="flex items-center mb-3">
            <input class="shrink-0 mt-0.5 border-gray-200 rounded-full text-blue-600 focus:ring-blue-500 disabled:opacity-50 disabled:pointer-events-none dark:bg-neutral-800 dark:border-neutral-700 dark:checked:bg-blue-500 dark:checked:border-blue-500 dark:focus:ring-offset-gray-800" type="radio" name="filter" value="not_visited" {% if filter == 'not_visited' %}checked{% endif %} id="filterNotVisited">
            <label for="filterNotVisited" class="text-sm text-gray-800 ms-2 dark:text-neutral-200 cursor-pointer">
                Не посещённые
            </label>
        </div>

        <hr class="my-4 border-gray-200 dark:border-neutral-700">

        <h6 class="text-sm font-semibold text-gray-800 dark:text-neutral-200 mb-3">Сортировка</h6>

        <div class="flex items-center mb-3">
            <input class="shrink-0 mt-0.5 border-gray-200 rounded-full text-red-600 focus:ring-red-500 disabled:opacity-50 disabled:pointer-events-none dark:bg-neutral-800 dark:border-neutral-700 dark:checked:bg-red-500 dark:checked:border-red-500 dark:focus:ring-offset-gray-800" type="radio" name="sort" value="name_down" {% if sort == 'name_down' or not sort|in_list:"name_down,name_up,first_visit_date_down,first_visit_date_up,last_visit_date_down,last_visit_date_up,number_of_visits_down,number_of_visits_up,date_of_foundation_down,date_of_foundation_up,number_of_users_who_visit_city_down,number_of_users_who_visit_city_up,number_of_visits_all_users_down,number_of_visits_all_users_up" %}checked{% endif %} id="sortNameDown">
            <label for="sortNameDown" class="text-sm text-gray-800 ms-2 dark:text-neutral-200 cursor-pointer">
                По названию (убывание)
            </label>
        </div>

        <div class="flex items-center mb-3">
            <input class="shrink-0 mt-0.5 border-gray-200 rounded-full text-red-600 focus:ring-red-500 disabled:opacity-50 disabled:pointer-events-none dark:bg-neutral-800 dark:border-neutral-700 dark:checked:bg-red-500 dark:checked:border-red-500 dark:focus:ring-offset-gray-800" type="radio" name="sort" value="name_up" {% if sort == 'name_up' %}checked{% endif %} id="sortNameUp">
            <label for="sortNameUp" class="text-sm text-gray-800 ms-2 dark:text-neutral-200 cursor-pointer">
                По названию (возрастание)
            </label>
        </div>

        <div class="flex items-center mb-3">
            <input class="shrink-0 mt-0.5 border-gray-200 rounded-full text-red-600 focus:ring-red-500 disabled:opacity-50 disabled:pointer-events-none dark:bg-neutral-800 dark:border-neutral-700 dark:checked:bg-red-500 dark:checked:border-red-500 dark:focus:ring-offset-gray-800" type="radio" name="sort" value="first_visit_date_down" {% if sort == 'first_visit_date_down' %}checked{% endif %} id="sortFirstVisitDateDown">
            <label for="sortFirstVisitDateDown" class="text-sm text-gray-800 ms-2 dark:text-neutral-200 cursor-pointer">
                По дате первого посещения (убывание)
            </label>
        </div>

        <div class="flex items-center mb-3">
            <input class="shrink-0 mt-0.5 border-gray-200 rounded-full text-red-600 focus:ring-red-500 disabled:opacity-50 disabled:pointer-events-none dark:bg-neutral-800 dark:border-neutral-700 dark:checked:bg-red-500 dark:checked:border-red-500 dark:focus:ring-offset-gray-800" type="radio" name="sort" value="first_visit_date_up" {% if sort == 'first_visit_date_up' %}checked{% endif %} id="sortFirstVisitDateUp">
            <label for="sortFirstVisitDateUp" class="text-sm text-gray-800 ms-2 dark:text-neutral-200 cursor-pointer">
                По дате первого посещения (возрастание)
            </label>
        </div>

        <div class="flex items-center mb-3">
            <input class="shrink-0 mt-0.5 border-gray-200 rounded-full text-red-600 focus:ring-red-500 disabled:opacity-50 disabled:pointer-events-none dark:bg-neutral-800 dark:border-neutral-700 dark:checked:bg-red-500 dark:checked:border-red-500 dark:focus:ring-offset-gray-800" type="radio" name="sort" value="last_visit_date_down" {% if sort == 'last_visit_date_down' %}checked{% endif %} id="sortLastVisitDateDown">
            <label for="sortLastVisitDateDown" class="text-sm text-gray-800 ms-2 dark:text-neutral-200 cursor-pointer">
                По дате последнего посещения (убывание)
            </label>
        </div>

        <div class="flex items-center mb-3">
            <input class="shrink-0 mt-0.5 border-gray-200 rounded-full text-red-600 focus:ring-red-500 disabled:opacity-50 disabled:pointer-events-none dark:bg-neutral-800 dark:border-neutral-700 dark:checked:bg-red-500 dark:checked:border-red-500 dark:focus:ring-offset-gray-800" type="radio" name="sort" value="last_visit_date_up" {% if sort == 'last_visit_date_up' %}checked{% endif %} id="sortLastVisitDateUp">
            <label for="sortLastVisitDateUp" class="text-sm text-gray-800 ms-2 dark:text-neutral-200 cursor-pointer">
                По дате последнего посещения (возрастание)
            </label>
        </div>

        <div class="flex items-center mb-3">
            <input class="shrink-0 mt-0.5 border-gray-200 rounded-full text-red-600 focus:ring-red-500 disabled:opacity-50 disabled:pointer-events-none dark:bg-neutral-800 dark:border-neutral-700 dark:checked:bg-red-500 dark:checked:border-red-500 dark:focus:ring-offset-gray-800" type="radio" name="sort" value="number_of_visits_down" {% if sort == 'number_of_visits_down' %}checked{% endif %} id="sortNumberOfVisitsDown">
            <label for="sortNumberOfVisitsDown" class="text-sm text-gray-800 ms-2 dark:text-neutral-200 cursor-pointer">
                По количеству посещений (убывание)
            </label>
        </div>

        <div class="flex items-center mb-3">
            <input class="shrink-0 mt-0.5 border-gray-200 rounded-full text-red-600 focus:ring-red-500 disabled:opacity-50 disabled:pointer-events-none dark:bg-neutral-800 dark:border-neutral-700 dark:checked:bg-red-500 dark:checked:border-red-500 dark:focus:ring-offset-gray-800" type="radio" name="sort" value="number_of_visits_up" {% if sort == 'number_of_visits_up' %}checked{% endif %} id="sortNumberOfVisitsUp">
            <label for="sortNumberOfVisitsUp" class="text-sm text-gray-800 ms-2 dark:text-neutral-200 cursor-pointer">
                По количеству посещений (возрастание)
            </label>
        </div>

        <div class="flex items-center mb-3">
            <input class="shrink-0 mt-0.5 border-gray-200 rounded-full text-red-600 focus:ring-red-500 disabled:opacity-50 disabled:pointer-events-none dark:bg-neutral-800 dark:border-neutral-700 dark:checked:bg-red-500 dark:checked:border-red-500 dark:focus:ring-offset-gray-800" type="radio" name="sort" value="date_of_foundation_down" {% if sort == 'date_of_foundation_down' %}checked{% endif %} id="sortDateOfFoundationDown">
            <label for="sortDateOfFoundationDown" class="text-sm text-gray-800 ms-2 dark:text-neutral-200 cursor-pointer">
                По дате основания (убывание)
            </label>
        </div>

        <div class="flex items-center mb-3">
            <input class="shrink-0 mt-0.5 border-gray-200 rounded-full text-red-600 focus:ring-red-500 disabled:opacity-50 disabled:pointer-events-none dark:bg-neutral-800 dark:border-neutral-700 dark:checked:bg-red-500 dark:checked:border-red-500 dark:focus:ring-offset-gray-800" type="radio" name="sort" value="date_of_foundation_up" {% if sort == 'date_of_foundation_up' %}checked{% endif %} id="sortDateOfFoundationUp">
            <label for="sortDateOfFoundationUp" class="text-sm text-gray-800 ms-2 dark:text-neutral-200 cursor-pointer">
                По дате основания (возрастание)
            </label>
        </div>

        <div class="flex items-center mb-3">
            <input class="shrink-0 mt-0.5 border-gray-200 rounded-full text-red-600 focus:ring-red-500 disabled:opacity-50 disabled:pointer-events-none dark:bg-neutral-800 dark:border-neutral-700 dark:checked:bg-red-500 dark:checked:border-red-500 dark:focus:ring-offset-gray-800" type="radio" name="sort" value="number_of_users_who_visit_city_down" {% if sort == 'number_of_users_who_visit_city_down' %}checked{% endif %} id="sortNumberOfUsersWhoVisitCityDown">
            <label for="sortNumberOfUsersWhoVisitCityDown" class="text-sm text-gray-800 ms-2 dark:text-neutral-200 cursor-pointer">
                По количеству посетивших пользователей (убывание)
            </label>
        </div>

        <div class="flex items-center mb-3">
            <input class="shrink-0 mt-0.5 border-gray-200 rounded-full text-red-600 focus:ring-red-500 disabled:opacity-50 disabled:pointer-events-none dark:bg-neutral-800 dark:border-neutral-700 dark:checked:bg-red-500 dark:checked:border-red-500 dark:focus:ring-offset-gray-800" type="radio" name="sort" value="number_of_users_who_visit_city_up" {% if sort == 'number_of_users_who_visit_city_up' %}checked{% endif %} id="sortNumberOfUsersWhoVisitCityUp">
            <label for="sortNumberOfUsersWhoVisitCityUp" class="text-sm text-gray-800 ms-2 dark:text-neutral-200 cursor-pointer">
                По количеству посетивших пользователей (возрастание)
            </label>
        </div>

        <div class="flex items-center mb-3">
            <input class="shrink-0 mt-0.5 border-gray-200 rounded-full text-red-600 focus:ring-red-500 disabled:opacity-50 disabled:pointer-events-none dark:bg-neutral-800 dark:border-neutral-700 dark:checked:bg-red-500 dark:checked:border-red-500 dark:focus:ring-offset-gray-800" type="radio" name="sort" value="number_of_visits_all_users_down" {% if sort == 'number_of_visits_all_users_down' %}checked{% endif %} id="sortNumberOfVisitsAllUsersDown">
            <label for="sortNumberOfVisitsAllUsersDown" class="text-sm text-gray-800 ms-2 dark:text-neutral-200 cursor-pointer">
                По общему количеству посещений (убывание)
            </label>
        </div>

        <div class="flex items-center mb-3">
            <input class="shrink-0 mt-0.5 border-gray-200 rounded-full text-red-600 focus:ring-red-500 disabled:opacity-50 disabled:pointer-events-none dark:bg-neutral-800 dark:border-neutral-700 dark:checked:bg-red-500 dark:checked:border-red-500 dark:focus:ring-offset-gray-800" type="radio" name="sort" value="number_of_visits_all_users_up" {% if sort == 'number_of_visits_all_users_up' %}checked{% endif %} id="sortNumberOfVisitsAllUsersUp">
            <label for="sortNumberOfVisitsAllUsersUp" class="text-sm text-gray-800 ms-2 dark:text-neutral-200 cursor-pointer">
                По общему количеству посещений (возрастание)
            </label>
        </div>

    </div>
    <div class="p-4 border-t border-gray-200 dark:border-neutral-700 shrink-0">
        <div class="flex gap-2">
            <button type="submit"
                    class="flex-1 py-2 px-4 inline-flex items-center justify-center gap-x-2 text-sm font-semibold rounded-lg border border-transparent bg-blue-600 text-white hover:bg-blue-700 disabled:opacity-50 disabled:pointer-events-none focus:outline-none focus:ring-2 focus:ring-blue-500 focus:ring-offset-2 dark:focus:ring-offset-neutral-800"
                    id="applyFilters"
                    data-filter="{{ filter|default:defaultFilter }}"
                    data-sort="{{ sort|default:defaultSort }}">Применить</button>
            <button type="button"
                    class="flex-1 py-2 px-4 inline-flex items-center justify-center gap-x-2 text-sm font-semibold rounded-lg border border-gray-200 bg-white text-gray-800 hover:bg-gray-50 disabled:opacity-50 disabled:pointer-events-none focus:outline-none focus:ring-2 focus:ring-gray-500 focus:ring-offset-2 dark:border-neutral-700 dark:bg-neutral-800 dark:text-neutral-200 dark:hover:bg-neutral-700 dark:focus:ring-offset-neutral-800"
                    id="resetFilters"
                    data-filter="{{ filter|default:defaultFilter }}"
                    data-sort="{{ sort|default:defaultSort }}">
                Сбросить
            </button>
        </div>
    </div>
</div>
{% endwith %}

{% vite_asset 'js/entries/filter_region.js' %}
{% endif %}