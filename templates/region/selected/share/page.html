{% extends 'base.html' %}
{% load vite %}
{% load static %}

{% block extra_css %}
    {{ block.super }}
    {% vite_css 'css/tailwind' %}
{% endblock %}

{% block content %}
    <header class="mx-3 mt-10 mb-6 text-center" id="section-page_header">
        <h1 class="text-2xl font-bold tracking-tight text-gray-900 dark:text-white sm:text-3xl">
            Поделиться прогрессом по региону
        </h1>
        <p class="mt-2 text-gray-600 dark:text-neutral-400">
            Скачайте изображение или поделитесь им в соцсетях
        </p>
    </header>

    <div class="mx-3 mb-6 flex flex-wrap items-center justify-center gap-3">
        <a href="{% url 'region-selected-list' pk=region_id %}" class="text-sm text-blue-600 hover:underline dark:text-blue-400">
            ← Вернуться к списку городов
        </a>
    </div>

    <!-- Изображение и настройки: на больших экранах в один ряд (настройки справа) -->
    <div class="mb-6 w-full px-4 sm:px-6">
        <div class="flex flex-col lg:flex-row lg:items-start lg:gap-6">
            <div class="min-w-0 lg:flex-1">
                <div id="share-image-wrapper" class="relative overflow-hidden rounded-2xl border border-gray-200 bg-white shadow-sm dark:border-neutral-700 dark:bg-neutral-900">
                    <div id="iso3166_code" data-iso3166_code="{{ iso3166_code }}" hidden></div>
                    <div id="share-image-container" class="relative flex items-center justify-center bg-gray-100 dark:bg-neutral-800">
                        <canvas id="share-image-canvas" width="800" height="520" class="block max-w-full h-auto"></canvas>
                        <div id="share-image-loading" class="absolute inset-0 flex items-center justify-center bg-white/80 dark:bg-neutral-900/80">
                            <span class="text-gray-600 dark:text-neutral-400">Загрузка границ региона…</span>
                        </div>
                    </div>
                </div>
            </div>

            <!-- Панель редактирования -->
            <div id="share-caption-panel" class="mt-4 lg:mt-0 min-w-0 flex-1 rounded-xl border border-gray-200 bg-white p-4 shadow-sm dark:border-neutral-700 dark:bg-neutral-800">
            <h3 class="mb-3 text-sm font-semibold text-gray-700 dark:text-neutral-300">Изображение</h3>
            <div class="flex flex-wrap gap-6">
                <fieldset class="flex flex-wrap gap-2">
                    <legend class="mb-1 text-xs font-medium text-gray-500 dark:text-neutral-400">Соотношение сторон</legend>
                    <label class="inline-flex cursor-pointer items-center gap-1.5 rounded-lg border px-3 py-2 text-sm transition has-[:checked]:border-blue-500 has-[:checked]:bg-blue-50 has-[:checked]:text-blue-700 dark:has-[:checked]:border-blue-400 dark:has-[:checked]:bg-blue-500/10 dark:has-[:checked]:text-blue-300">
                        <input type="radio" name="share-aspect-ratio" value="16:9" class="border-gray-300 text-blue-600 focus:ring-blue-500">
                        16∶9
                    </label>
                    <label class="inline-flex cursor-pointer items-center gap-1.5 rounded-lg border px-3 py-2 text-sm transition has-[:checked]:border-blue-500 has-[:checked]:bg-blue-50 has-[:checked]:text-blue-700 dark:has-[:checked]:border-blue-400 dark:has-[:checked]:bg-blue-500/10 dark:has-[:checked]:text-blue-300">
                        <input type="radio" name="share-aspect-ratio" value="4:3" class="border-gray-300 text-blue-600 focus:ring-blue-500" checked>
                        4∶3
                    </label>
                    <label class="inline-flex cursor-pointer items-center gap-1.5 rounded-lg border px-3 py-2 text-sm transition has-[:checked]:border-blue-500 has-[:checked]:bg-blue-50 has-[:checked]:text-blue-700 dark:has-[:checked]:border-blue-400 dark:has-[:checked]:bg-blue-500/10 dark:has-[:checked]:text-blue-300">
                        <input type="radio" name="share-aspect-ratio" value="1:1" class="border-gray-300 text-blue-600 focus:ring-blue-500">
                        1∶1
                    </label>
                    <label class="inline-flex cursor-pointer items-center gap-1.5 rounded-lg border px-3 py-2 text-sm transition has-[:checked]:border-blue-500 has-[:checked]:bg-blue-50 has-[:checked]:text-blue-700 dark:has-[:checked]:border-blue-400 dark:has-[:checked]:bg-blue-500/10 dark:has-[:checked]:text-blue-300">
                        <input type="radio" name="share-aspect-ratio" value="3:4" class="border-gray-300 text-blue-600 focus:ring-blue-500">
                        3∶4
                    </label>
                    <label class="inline-flex cursor-pointer items-center gap-1.5 rounded-lg border px-3 py-2 text-sm transition has-[:checked]:border-blue-500 has-[:checked]:bg-blue-50 has-[:checked]:text-blue-700 dark:has-[:checked]:border-blue-400 dark:has-[:checked]:bg-blue-500/10 dark:has-[:checked]:text-blue-300">
                        <input type="radio" name="share-aspect-ratio" value="9:16" class="border-gray-300 text-blue-600 focus:ring-blue-500">
                        9∶16
                    </label>
                </fieldset>
                <fieldset class="flex flex-wrap gap-2">
                    <legend class="mb-1 text-xs font-medium text-gray-500 dark:text-neutral-400">Разрешение</legend>
                    <label class="inline-flex cursor-pointer items-center gap-1.5 rounded-lg border px-3 py-2 text-sm transition has-[:checked]:border-blue-500 has-[:checked]:bg-blue-50 has-[:checked]:text-blue-700 dark:has-[:checked]:border-blue-400 dark:has-[:checked]:bg-blue-500/10 dark:has-[:checked]:text-blue-300">
                        <input type="radio" name="share-resolution" value="720" class="border-gray-300 text-blue-600 focus:ring-blue-500">
                        720p
                    </label>
                    <label class="inline-flex cursor-pointer items-center gap-1.5 rounded-lg border px-3 py-2 text-sm transition has-[:checked]:border-blue-500 has-[:checked]:bg-blue-50 has-[:checked]:text-blue-700 dark:has-[:checked]:border-blue-400 dark:has-[:checked]:bg-blue-500/10 dark:has-[:checked]:text-blue-300">
                        <input type="radio" name="share-resolution" value="1080" class="border-gray-300 text-blue-600 focus:ring-blue-500" checked>
                        1080p
                    </label>
                    <label class="inline-flex cursor-pointer items-center gap-1.5 rounded-lg border px-3 py-2 text-sm transition has-[:checked]:border-blue-500 has-[:checked]:bg-blue-50 has-[:checked]:text-blue-700 dark:has-[:checked]:border-blue-400 dark:has-[:checked]:bg-blue-500/10 dark:has-[:checked]:text-blue-300">
                        <input type="radio" name="share-resolution" value="1440" class="border-gray-300 text-blue-600 focus:ring-blue-500">
                        2K
                    </label>
                </fieldset>
                <fieldset class="flex flex-wrap gap-2">
                    <legend class="mb-1 text-xs font-medium text-gray-500 dark:text-neutral-400">Подложка</legend>
                    <label class="inline-flex cursor-pointer items-center gap-1.5 rounded-lg border px-3 py-2 text-sm transition has-[:checked]:border-blue-500 has-[:checked]:bg-blue-50 has-[:checked]:text-blue-700 dark:has-[:checked]:border-blue-400 dark:has-[:checked]:bg-blue-500/10 dark:has-[:checked]:text-blue-300">
                        <input type="radio" name="share-background" value="none" class="border-gray-300 text-blue-600 focus:ring-blue-500" checked>
                        Без подложки
                    </label>
                    <label class="inline-flex cursor-pointer items-center gap-1.5 rounded-lg border px-3 py-2 text-sm transition has-[:checked]:border-blue-500 has-[:checked]:bg-blue-50 has-[:checked]:text-blue-700 dark:has-[:checked]:border-blue-400 dark:has-[:checked]:bg-blue-500/10 dark:has-[:checked]:text-blue-300">
                        <input type="radio" name="share-background" value="osm" class="border-gray-300 text-blue-600 focus:ring-blue-500">
                        Карта OpenStreetMap
                    </label>
                </fieldset>
                <fieldset class="flex flex-wrap gap-2">
                    <legend class="mb-1 text-xs font-medium text-gray-500 dark:text-neutral-400">Копирайт</legend>
                    <label class="inline-flex cursor-pointer items-center gap-1.5 rounded-lg border px-3 py-2 text-sm transition has-[:checked]:border-blue-500 has-[:checked]:bg-blue-50 has-[:checked]:text-blue-700 dark:has-[:checked]:border-blue-400 dark:has-[:checked]:bg-blue-500/10 dark:has-[:checked]:text-blue-300">
                        <input type="radio" name="share-watermark" value="top-right" class="border-gray-300 text-blue-600 focus:ring-blue-500" checked>
                        Сверху справа
                    </label>
                    <label class="inline-flex cursor-pointer items-center gap-1.5 rounded-lg border px-3 py-2 text-sm transition has-[:checked]:border-blue-500 has-[:checked]:bg-blue-50 has-[:checked]:text-blue-700 dark:has-[:checked]:border-blue-400 dark:has-[:checked]:bg-blue-500/10 dark:has-[:checked]:text-blue-300">
                        <input type="radio" name="share-watermark" value="top-left" class="border-gray-300 text-blue-600 focus:ring-blue-500">
                        Сверху слева
                    </label>
                    <label class="inline-flex cursor-pointer items-center gap-1.5 rounded-lg border px-3 py-2 text-sm transition has-[:checked]:border-blue-500 has-[:checked]:bg-blue-50 has-[:checked]:text-blue-700 dark:has-[:checked]:border-blue-400 dark:has-[:checked]:bg-blue-500/10 dark:has-[:checked]:text-blue-300">
                        <input type="radio" name="share-watermark" value="bottom-right" class="border-gray-300 text-blue-600 focus:ring-blue-500">
                        Снизу справа
                    </label>
                    <label class="inline-flex cursor-pointer items-center gap-1.5 rounded-lg border px-3 py-2 text-sm transition has-[:checked]:border-blue-500 has-[:checked]:bg-blue-50 has-[:checked]:text-blue-700 dark:has-[:checked]:border-blue-400 dark:has-[:checked]:bg-blue-500/10 dark:has-[:checked]:text-blue-300">
                        <input type="radio" name="share-watermark" value="bottom-left" class="border-gray-300 text-blue-600 focus:ring-blue-500">
                        Снизу слева
                    </label>
                    <label class="inline-flex cursor-pointer items-center gap-1.5 rounded-lg border px-3 py-2 text-sm transition has-[:checked]:border-blue-500 has-[:checked]:bg-blue-50 has-[:checked]:text-blue-700 dark:has-[:checked]:border-blue-400 dark:has-[:checked]:bg-blue-500/10 dark:has-[:checked]:text-blue-300">
                        <input type="radio" name="share-watermark" value="off" class="border-gray-300 text-blue-600 focus:ring-blue-500">
                        Выключен
                    </label>
                </fieldset>
            </div>
            <h3 class="mb-3 mt-4 text-sm font-semibold text-gray-700 dark:text-neutral-300">Текст на изображении</h3>
            <div class="flex flex-wrap gap-6">
                <fieldset class="flex flex-wrap gap-2 w-full" id="caption-text-fieldset">
                    <legend class="mb-1 text-xs font-medium text-gray-500 dark:text-neutral-400">Вариант подписи</legend>
                    <label class="inline-flex cursor-pointer items-center gap-1.5 rounded-lg border px-3 py-2 text-sm transition has-[:checked]:border-blue-500 has-[:checked]:bg-blue-50 has-[:checked]:text-blue-700 dark:has-[:checked]:border-blue-400 dark:has-[:checked]:bg-blue-500/10 dark:has-[:checked]:text-blue-300">
                        <input type="radio" name="caption-text-preset" value="0" class="border-gray-300 text-blue-600 focus:ring-blue-500" checked>
                        Я посетил N из M городов региона
                    </label>
                    <label class="inline-flex cursor-pointer items-center gap-1.5 rounded-lg border px-3 py-2 text-sm transition has-[:checked]:border-blue-500 has-[:checked]:bg-blue-50 has-[:checked]:text-blue-700 dark:has-[:checked]:border-blue-400 dark:has-[:checked]:bg-blue-500/10 dark:has-[:checked]:text-blue-300">
                        <input type="radio" name="caption-text-preset" value="1" class="border-gray-300 text-blue-600 focus:ring-blue-500">
                        Цель достигнута: N из M городов региона
                    </label>
                    <label class="inline-flex cursor-pointer items-center gap-1.5 rounded-lg border px-3 py-2 text-sm transition has-[:checked]:border-blue-500 has-[:checked]:bg-blue-50 has-[:checked]:text-blue-700 dark:has-[:checked]:border-blue-400 dark:has-[:checked]:bg-blue-500/10 dark:has-[:checked]:text-blue-300">
                        <input type="radio" name="caption-text-preset" value="2" class="border-gray-300 text-blue-600 focus:ring-blue-500">
                        Регион (N из M)
                    </label>
                    <label class="inline-flex cursor-pointer items-center gap-1.5 rounded-lg border px-3 py-2 text-sm transition has-[:checked]:border-blue-500 has-[:checked]:bg-blue-50 has-[:checked]:text-blue-700 dark:has-[:checked]:border-blue-400 dark:has-[:checked]:bg-blue-500/10 dark:has-[:checked]:text-blue-300">
                        <input type="radio" name="caption-text-preset" value="custom" class="border-gray-300 text-blue-600 focus:ring-blue-500">
                        Свой текст
                    </label>
                    <div class="w-full mt-2" id="caption-text-custom-wrap" style="display: none;">
                        <label for="caption-text-custom" class="sr-only">Свой текст подписи</label>
                        <input type="text" id="caption-text-custom" name="caption-text-custom" placeholder="Введите свой текст подписи"
                            class="w-full rounded-lg border border-gray-300 px-3 py-2 text-sm dark:border-neutral-600 dark:bg-neutral-800 dark:text-white">
                    </div>
                </fieldset>
                <fieldset class="flex flex-wrap gap-2">
                    <legend class="mb-1 text-xs font-medium text-gray-500 dark:text-neutral-400">Положение</legend>
                    <label class="inline-flex cursor-pointer items-center gap-1.5 rounded-lg border px-3 py-2 text-sm transition has-[:checked]:border-blue-500 has-[:checked]:bg-blue-50 has-[:checked]:text-blue-700 dark:has-[:checked]:border-blue-400 dark:has-[:checked]:bg-blue-500/10 dark:has-[:checked]:text-blue-300">
                        <input type="radio" name="caption-position" value="top" class="border-gray-300 text-blue-600 focus:ring-blue-500">
                        Сверху
                    </label>
                    <label class="inline-flex cursor-pointer items-center gap-1.5 rounded-lg border px-3 py-2 text-sm transition has-[:checked]:border-blue-500 has-[:checked]:bg-blue-50 has-[:checked]:text-blue-700 dark:has-[:checked]:border-blue-400 dark:has-[:checked]:bg-blue-500/10 dark:has-[:checked]:text-blue-300">
                        <input type="radio" name="caption-position" value="center" class="border-gray-300 text-blue-600 focus:ring-blue-500">
                        По центру
                    </label>
                    <label class="inline-flex cursor-pointer items-center gap-1.5 rounded-lg border px-3 py-2 text-sm transition has-[:checked]:border-blue-500 has-[:checked]:bg-blue-50 has-[:checked]:text-blue-700 dark:has-[:checked]:border-blue-400 dark:has-[:checked]:bg-blue-500/10 dark:has-[:checked]:text-blue-300">
                        <input type="radio" name="caption-position" value="bottom" class="border-gray-300 text-blue-600 focus:ring-blue-500" checked>
                        Снизу
                    </label>
                </fieldset>
                <fieldset class="flex flex-wrap gap-2">
                    <legend class="mb-1 text-xs font-medium text-gray-500 dark:text-neutral-400">Выравнивание текста</legend>
                    <label class="inline-flex cursor-pointer items-center gap-1.5 rounded-lg border px-3 py-2 text-sm transition has-[:checked]:border-blue-500 has-[:checked]:bg-blue-50 has-[:checked]:text-blue-700 dark:has-[:checked]:border-blue-400 dark:has-[:checked]:bg-blue-500/10 dark:has-[:checked]:text-blue-300">
                        <input type="radio" name="caption-align" value="left" class="border-gray-300 text-blue-600 focus:ring-blue-500">
                        По левому краю
                    </label>
                    <label class="inline-flex cursor-pointer items-center gap-1.5 rounded-lg border px-3 py-2 text-sm transition has-[:checked]:border-blue-500 has-[:checked]:bg-blue-50 has-[:checked]:text-blue-700 dark:has-[:checked]:border-blue-400 dark:has-[:checked]:bg-blue-500/10 dark:has-[:checked]:text-blue-300">
                        <input type="radio" name="caption-align" value="center" class="border-gray-300 text-blue-600 focus:ring-blue-500" checked>
                        По центру
                    </label>
                    <label class="inline-flex cursor-pointer items-center gap-1.5 rounded-lg border px-3 py-2 text-sm transition has-[:checked]:border-blue-500 has-[:checked]:bg-blue-50 has-[:checked]:text-blue-700 dark:has-[:checked]:border-blue-400 dark:has-[:checked]:bg-blue-500/10 dark:has-[:checked]:text-blue-300">
                        <input type="radio" name="caption-align" value="right" class="border-gray-300 text-blue-600 focus:ring-blue-500">
                        По правому краю
                    </label>
                </fieldset>
                <fieldset class="flex flex-wrap gap-2">
                    <legend class="mb-1 text-xs font-medium text-gray-500 dark:text-neutral-400">Размер</legend>
                    <label class="inline-flex cursor-pointer items-center gap-1.5 rounded-lg border px-3 py-2 text-sm transition has-[:checked]:border-blue-500 has-[:checked]:bg-blue-50 has-[:checked]:text-blue-700 dark:has-[:checked]:border-blue-400 dark:has-[:checked]:bg-blue-500/10 dark:has-[:checked]:text-blue-300">
                        <input type="radio" name="caption-font-size" value="16" class="border-gray-300 text-blue-600 focus:ring-blue-500">
                        Маленький
                    </label>
                    <label class="inline-flex cursor-pointer items-center gap-1.5 rounded-lg border px-3 py-2 text-sm transition has-[:checked]:border-blue-500 has-[:checked]:bg-blue-50 has-[:checked]:text-blue-700 dark:has-[:checked]:border-blue-400 dark:has-[:checked]:bg-blue-500/10 dark:has-[:checked]:text-blue-300">
                        <input type="radio" name="caption-font-size" value="20" class="border-gray-300 text-blue-600 focus:ring-blue-500" checked>
                        Средний
                    </label>
                    <label class="inline-flex cursor-pointer items-center gap-1.5 rounded-lg border px-3 py-2 text-sm transition has-[:checked]:border-blue-500 has-[:checked]:bg-blue-50 has-[:checked]:text-blue-700 dark:has-[:checked]:border-blue-400 dark:has-[:checked]:bg-blue-500/10 dark:has-[:checked]:text-blue-300">
                        <input type="radio" name="caption-font-size" value="24" class="border-gray-300 text-blue-600 focus:ring-blue-500">
                        Большой
                    </label>
                </fieldset>
                <fieldset class="flex flex-wrap gap-2">
                    <legend class="mb-1 text-xs font-medium text-gray-500 dark:text-neutral-400">Шрифт</legend>
                    <label class="inline-flex cursor-pointer items-center gap-1.5 rounded-lg border px-3 py-2 text-sm transition has-[:checked]:border-blue-500 has-[:checked]:bg-blue-50 has-[:checked]:text-blue-700 dark:has-[:checked]:border-blue-400 dark:has-[:checked]:bg-blue-500/10 dark:has-[:checked]:text-blue-300">
                        <input type="radio" name="caption-font-family" value="sans" class="border-gray-300 text-blue-600 focus:ring-blue-500" checked>
                        Без засечек
                    </label>
                    <label class="inline-flex cursor-pointer items-center gap-1.5 rounded-lg border px-3 py-2 text-sm transition has-[:checked]:border-blue-500 has-[:checked]:bg-blue-50 has-[:checked]:text-blue-700 dark:has-[:checked]:border-blue-400 dark:has-[:checked]:bg-blue-500/10 dark:has-[:checked]:text-blue-300">
                        <input type="radio" name="caption-font-family" value="serif" class="border-gray-300 text-blue-600 focus:ring-blue-500">
                        С засечками
                    </label>
                    <label class="inline-flex cursor-pointer items-center gap-1.5 rounded-lg border px-3 py-2 text-sm transition has-[:checked]:border-blue-500 has-[:checked]:bg-blue-50 has-[:checked]:text-blue-700 dark:has-[:checked]:border-blue-400 dark:has-[:checked]:bg-blue-500/10 dark:has-[:checked]:text-blue-300">
                        <input type="radio" name="caption-font-family" value="mono" class="border-gray-300 text-blue-600 focus:ring-blue-500">
                        Моноширинный
                    </label>
                </fieldset>
                <fieldset class="flex flex-wrap gap-2">
                    <legend class="mb-1 text-xs font-medium text-gray-500 dark:text-neutral-400">Начертание</legend>
                    <label class="inline-flex cursor-pointer items-center gap-1.5 rounded-lg border px-3 py-2 text-sm transition has-[:checked]:border-blue-500 has-[:checked]:bg-blue-50 has-[:checked]:text-blue-700 dark:has-[:checked]:border-blue-400 dark:has-[:checked]:bg-blue-500/10 dark:has-[:checked]:text-blue-300">
                        <input type="radio" name="caption-font-weight" value="normal" class="border-gray-300 text-blue-600 focus:ring-blue-500">
                        Обычный
                    </label>
                    <label class="inline-flex cursor-pointer items-center gap-1.5 rounded-lg border px-3 py-2 text-sm transition has-[:checked]:border-blue-500 has-[:checked]:bg-blue-50 has-[:checked]:text-blue-700 dark:has-[:checked]:border-blue-400 dark:has-[:checked]:bg-blue-500/10 dark:has-[:checked]:text-blue-300">
                        <input type="radio" name="caption-font-weight" value="bold" class="border-gray-300 text-blue-600 focus:ring-blue-500" checked>
                        Жирный
                    </label>
                </fieldset>
                <fieldset class="flex flex-wrap gap-2">
                    <legend class="mb-1 text-xs font-medium text-gray-500 dark:text-neutral-400">Фон подписи</legend>
                    <label class="inline-flex cursor-pointer items-center gap-1.5 rounded-lg border px-3 py-2 text-sm transition has-[:checked]:border-blue-500 has-[:checked]:bg-blue-50 has-[:checked]:text-blue-700 dark:has-[:checked]:border-blue-400 dark:has-[:checked]:bg-blue-500/10 dark:has-[:checked]:text-blue-300">
                        <input type="radio" name="caption-background" value="none" class="border-gray-300 text-blue-600 focus:ring-blue-500">
                        Без фона
                    </label>
                    <label class="inline-flex cursor-pointer items-center gap-1.5 rounded-lg border px-3 py-2 text-sm transition has-[:checked]:border-blue-500 has-[:checked]:bg-blue-50 has-[:checked]:text-blue-700 dark:has-[:checked]:border-blue-400 dark:has-[:checked]:bg-blue-500/10 dark:has-[:checked]:text-blue-300">
                        <input type="radio" name="caption-background" value="outline" class="border-gray-300 text-blue-600 focus:ring-blue-500">
                        Обводка букв
                    </label>
                    <label class="inline-flex cursor-pointer items-center gap-1.5 rounded-lg border px-3 py-2 text-sm transition has-[:checked]:border-blue-500 has-[:checked]:bg-blue-50 has-[:checked]:text-blue-700 dark:has-[:checked]:border-blue-400 dark:has-[:checked]:bg-blue-500/10 dark:has-[:checked]:text-blue-300">
                        <input type="radio" name="caption-background" value="box" class="border-gray-300 text-blue-600 focus:ring-blue-500" checked>
                        Бокс за текстом
                    </label>
                </fieldset>
                <fieldset class="flex flex-wrap items-end gap-4">
                    <legend class="mb-1 w-full text-xs font-medium text-gray-500 dark:text-neutral-400">Параметры фона</legend>
                    <label for="caption-bg-color" class="block mb-2 text-sm font-medium text-foreground">Цвет</label>
                    <input type="color" id="caption-bg-color" name="caption-bg-color" value="#ef4444" title="Выберите цвет фона" class="p-1 h-10 w-14 block bg-layer border border-layer-line cursor-pointer rounded-lg disabled:opacity-50 disabled:pointer-events-none">
                    <div class="flex flex-col gap-1 min-w-[8rem]">
                        <span class="text-xs text-gray-500 dark:text-neutral-400">Размер <span id="caption-bg-size-value">1</span></span>
                        <div class="w-full">
                            <label for="caption-bg-size" class="sr-only">Размер</label>
                            <input type="range" id="caption-bg-size" name="caption-bg-size" min="50" max="300" step="5" value="100" aria-orientation="horizontal" class="range-slider">
                        </div>
                    </div>
                    <div class="flex flex-col gap-1 min-w-[8rem]">
                        <span class="text-xs text-gray-500 dark:text-neutral-400">Прозрачность <span id="caption-bg-opacity-value">50</span>%</span>
                        <div class="w-full">
                            <label for="caption-bg-opacity" class="sr-only">Прозрачность фона</label>
                            <input type="range" id="caption-bg-opacity" name="caption-bg-opacity" min="0" max="100" value="50" aria-orientation="horizontal" class="range-slider">
                        </div>
                    </div>
                    <div class="flex flex-col gap-1 min-w-[8rem]">
                        <span class="text-xs text-gray-500 dark:text-neutral-400">Размытие <span id="caption-bg-blur-value">10</span>px</span>
                        <div class="w-full">
                            <label for="caption-bg-blur" class="sr-only">Размытие фона</label>
                            <input type="range" id="caption-bg-blur" name="caption-bg-blur" min="0" max="20" value="10" aria-orientation="horizontal" class="range-slider">
                        </div>
                    </div>
                </fieldset>
            </div>
        </div>
        </div>

        <div class="mt-4 flex flex-wrap items-center justify-center gap-3">
            <button type="button" id="btn-download-share-image"
                    class="inline-flex items-center gap-x-2 rounded-xl border border-emerald-500 px-4 py-2 text-sm font-semibold text-emerald-600 transition hover:bg-emerald-50 focus:outline-none focus:ring-2 focus:ring-emerald-500 focus:ring-offset-2 dark:border-emerald-400 dark:text-emerald-300 dark:hover:bg-emerald-500/10">
                <svg xmlns="http://www.w3.org/2000/svg" class="size-5" fill="none" viewBox="0 0 24 24" stroke="currentColor" stroke-width="2">
                    <path stroke-linecap="round" stroke-linejoin="round" d="M4 16v1a3 3 0 003 3h10a3 3 0 003-3v-1m-4-4l-4 4m0 0l-4-4m4 4V4"/>
                </svg>
                Скачать изображение
            </button>
            <button type="button" id="btn-share-image" disabled
                    class="inline-flex items-center gap-x-2 rounded-xl border border-gray-300 px-4 py-2 text-sm font-semibold text-gray-700 transition hover:bg-gray-50 disabled:opacity-50 dark:border-neutral-600 dark:text-neutral-300 dark:hover:bg-neutral-800">
                <svg xmlns="http://www.w3.org/2000/svg" class="size-5" fill="none" viewBox="0 0 24 24" stroke="currentColor" stroke-width="2">
                    <path stroke-linecap="round" stroke-linejoin="round" d="M8.684 13.342C8.886 12.938 9 12.482 9 12c0-.482-.114-.938-.316-1.342m0 2.684a3 3 0 110-2.684m0 2.684l6.632 3.316m-6.632-6l6.632-3.316m0 0a3 3 0 105.367-2.684 3 3 0 00-5.367 2.684zm0 9.316a3 3 0 105.368 2.684 3 3 0 00-5.368-2.684z"/>
                </svg>
                Поделиться
            </button>
        </div>
    </div>

    <script>
        window.URL_GEO_POLYGONS = "{{ URL_GEO_POLYGONS }}";
        window.TILE_LAYER = "{{ TILE_LAYER }}";
        window.REGION_NAME = "{{ region_name|escapejs }}";
        window.SHARE_NUMBER_OF_VISITED = {{ number_of_visited_cities }};
        window.SHARE_NUMBER_OF_CITIES = {{ number_of_cities }};
        window.ALL_CITIES = [];
        {% for city in all_cities %}
            window.ALL_CITIES.push({
                id: {{ city.id }},
                name: "{{ city.title|escapejs }}",
                lat: parseFloat('{{ city.coordinate_width }}'.replace(/,/, '.')),
                lon: parseFloat('{{ city.coordinate_longitude }}'.replace(/,/, '.')),
                isVisited: {{ city.is_visited|yesno:"true,false" }},
                numberOfVisits: {{ city.number_of_visits|default:'null' }},
                firstVisitDate: "{{ city.first_visit_date|date:'Y-m-d'|default_if_none:'' }}",
                lastVisitDate: "{{ city.last_visit_date|date:'Y-m-d'|default_if_none:'' }}",
                numberOfUsersWhoVisitCity: {{ city.number_of_users_who_visit_city|default:'null' }},
                numberOfVisitsAllUsers: {{ city.number_of_visits_all_users|default:'null' }}
            });
        {% endfor %}
    </script>
    {% vite_asset 'js/entries/share_region_image.js' %}
{% endblock %}
