{% extends 'base.html' %}
{% load vite %}

{% block extra_css %}
    {{ block.super }}
    {% vite_css 'css/tailwind' %}
    <style>
        /* Изображения в один ряд, одинакового размера */
        .article-detail-content p:has(> img:only-child),
        .article-detail-content figure:has(> img) {
            display: inline-block;
            width: 180px;
            margin: 0 0.5rem 0.5rem 0;
            vertical-align: top;
        }
        .article-detail-content p:has(> img:only-child) img,
        .article-detail-content figure:has(> img) img {
            width: 100%;
            height: 180px;
            object-fit: cover;
            display: block;
        }
        /* Изображения внутри текста — обычный вид */
        .article-detail-content p:not(:has(> img:only-child)) img {
            max-width: 100%;
            height: auto;
            margin-bottom: 1rem;
        }
    </style>
{% endblock %}

{% block extra_js %}
    {{ block.super }}
    {% vite_asset 'js/entries/content_image_gallery.js' %}
{% endblock %}

{% block content %}
    <div class="mx-3 mb-8 flex justify-center">
        <div class="w-full max-w-4xl">
            <article class="rounded-xl border border-gray-200 bg-white p-6 shadow-sm dark:border-neutral-700 dark:bg-neutral-900" id="article_{{ article.id }}">
                <!-- Заголовок статьи -->
                <h1 class="mb-6 text-3xl font-bold tracking-tight text-gray-900 dark:text-white">
                    {{ article.title }}
                </h1>

                <!-- Контент статьи -->
                <div class="content-with-image-gallery article-detail-content text-gray-900 dark:text-white [&_h1]:text-2xl [&_h1]:font-bold [&_h1]:mb-4 [&_h2]:text-xl [&_h2]:font-semibold [&_h2]:mb-3 [&_h2]:mt-5 [&_h3]:text-lg [&_h3]:font-semibold [&_h3]:mb-2 [&_h3]:mt-4 [&_p]:mb-4 [&_ul]:list-disc [&_ul]:ml-6 [&_ul]:mb-4 [&_ol]:list-decimal [&_ol]:ml-6 [&_ol]:mb-4 [&_a]:text-blue-600 [&_a]:dark:text-blue-400 [&_a]:hover:underline [&_strong]:font-semibold [&_code]:bg-gray-100 [&_code]:dark:bg-neutral-800 [&_code]:px-1.5 [&_code]:py-0.5 [&_code]:rounded [&_code]:text-sm [&_code]:font-mono [&_pre]:bg-gray-100 [&_pre]:dark:bg-neutral-800 [&_pre]:p-4 [&_pre]:rounded-lg [&_pre]:overflow-x-auto [&_pre]:mb-4 [&_img]:rounded-lg [&_img]:cursor-pointer [&_img]:transition-opacity [&_img]:duration-200 [&_img]:hover:opacity-90">
                    {{ article.content|safe }}
                </div>

                <!-- Разделитель -->
                <hr class="my-4 border-gray-200 dark:border-neutral-700">

                <!-- Футер с метаданными -->
                <div class="flex flex-wrap items-center gap-4 text-sm text-gray-600 dark:text-neutral-400">
                    {% if article.city %}
                        <div class="flex items-center gap-2">
                            <span class="font-medium">Город:</span>
                            <a href="{{ article.city.get_absolute_url }}"
                               class="text-blue-600 hover:underline dark:text-blue-400">
                                {{ article.city.title }}
                            </a>
                        </div>
                    {% endif %}
                    {% if article.tags.exists %}
                        <div class="flex flex-wrap items-center gap-2">
                            <span class="font-medium">Теги:</span>
                            {% for tag in article.tags.all %}
                                <span class="rounded-full bg-gray-100 px-2.5 py-0.5 text-xs font-medium text-gray-700 dark:bg-neutral-700 dark:text-neutral-300">{{ tag.name }}</span>
                            {% endfor %}
                        </div>
                    {% endif %}
                    <div class="ml-auto flex items-center gap-2">
                        <span class="font-medium">Создано:</span>
                        <span>{{ article.created_at }}</span>
                    </div>
                </div>
            </article>
        </div>
    </div>
{% endblock %}
