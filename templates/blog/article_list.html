{% extends 'base.html' %}
{% load vite %}

{% block extra_css %}
    {{ block.super }}
    {% vite_css 'css/tailwind' %}
    {% vite_css 'css/content_image_gallery' %}
{% endblock %}

{% block extra_js %}
    {{ block.super }}
    {% vite_asset 'js/entries/content_image_gallery.js' %}
{% endblock %}

{% block content %}
    <!-- Заголовок и хлебные крошки -->
    <header class="mx-3 mt-10 mb-6" id="block-page_header">
        <h1 class="flex items-end justify-center text-3xl font-bold tracking-tight text-gray-900 sm:text-4xl lg:text-5xl dark:text-white">
            Блог о городах
        </h1>

        {% if not DEBUG %}
            {% include 'advertisement/rtb_banner.html' %}
        {% endif %}

        <nav aria-label="Хлебные крошки" class="flex justify-center mt-6">
            <ol class="flex flex-wrap items-center justify-center whitespace-nowrap py-2 border-y border-gray-200 dark:border-neutral-700 text-sm">
                {% if filter_tag %}
                    <li class="inline-flex items-center">
                        <a class="flex items-center text-gray-600 hover:text-blue-600 focus:outline-none focus:text-blue-600 dark:text-neutral-400 dark:hover:text-blue-400 dark:focus:text-blue-400" href="{% url 'blog-list' %}">
                            <svg class="shrink-0 mr-3 size-4" xmlns="http://www.w3.org/2000/svg" width="24" height="24" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2" stroke-linecap="round" stroke-linejoin="round">
                                <path d="M14 2H6a2 2 0 0 0-2 2v16a2 2 0 0 0 2 2h12a2 2 0 0 0 2-2V8z"/>
                                <polyline points="14 2 14 8 20 8"/>
                                <line x1="16" x2="8" y1="13" y2="13"/>
                                <line x1="16" x2="8" y1="17" y2="17"/>
                                <line x1="10" x2="8" y1="9" y2="9"/>
                            </svg>
                            Все статьи
                        </a>
                        <svg class="shrink-0 mx-2 size-4 text-gray-400 dark:text-neutral-500" xmlns="http://www.w3.org/2000/svg" width="24" height="24" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2" stroke-linecap="round" stroke-linejoin="round">
                            <path d="m9 18 6-6-6-6"/>
                        </svg>
                    </li>
                    <li class="inline-flex items-center text-sm font-semibold text-gray-900 dark:text-white truncate" aria-current="page">
                        <svg class="shrink-0 mr-1.5 size-4 text-gray-500 dark:text-neutral-400" xmlns="http://www.w3.org/2000/svg" width="24" height="24" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2" stroke-linecap="round" stroke-linejoin="round">
                            <path d="M12 2H2v10l9.29 9.29c.94.94 2.48.94 3.42 0l6.58-6.58c.94-.94.94-2.48 0-3.42L12 2Z"/>
                            <path d="M7 7h.01"/>
                        </svg>
                        Тег «{{ filter_tag.name }}»
                    </li>
                {% else %}
                    <li class="inline-flex items-center text-sm font-semibold text-gray-900 dark:text-white truncate" aria-current="page">
                        <svg class="shrink-0 mr-1.5 size-4 text-gray-500 dark:text-neutral-400" xmlns="http://www.w3.org/2000/svg" width="24" height="24" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2" stroke-linecap="round" stroke-linejoin="round">
                            <path d="M14 2H6a2 2 0 0 0-2 2v16a2 2 0 0 0 2 2h12a2 2 0 0 0 2-2V8z"/>
                            <polyline points="14 2 14 8 20 8"/>
                            <line x1="16" x2="8" y1="13" y2="13"/>
                            <line x1="16" x2="8" y1="17" y2="17"/>
                            <line x1="10" x2="8" y1="9" y2="9"/>
                        </svg>
                        Все статьи
                    </li>
                {% endif %}
            </ol>
        </nav>
    </header>
    <!-- ^^^ Хлебные крошки и заголовок -->

    <div class="mx-3 mb-8 flex justify-center">
        <div class="w-full max-w-4xl">
            {% for article in article_list %}
                <div class="mb-6 rounded-xl border border-gray-200 bg-white p-6 shadow-sm dark:border-neutral-700 dark:bg-neutral-900" id="article_{{ article.id }}">
                    <!-- Заголовок статьи -->
                    <h2 class="mb-2 text-xl font-semibold text-gray-900 dark:text-white flex flex-wrap items-center gap-2">
                        {% if not article.is_published %}
                            <span class="inline-flex items-center gap-1 rounded-full border border-red-300 bg-red-100 px-2.5 py-0.5 text-xs font-medium text-red-800 dark:border-red-500/40 dark:bg-red-500/20 dark:text-red-300">Черновик</span>
                        {% endif %}
                        <a href="{% url 'blog-article-detail' slug=article.slug %}"
                           class="hover:text-blue-600 dark:hover:text-blue-400 hover:underline">
                            {{ article.title }}
                        </a>
                    </h2>
                    <!-- Бейджи: город, теги -->
                    <div class="mb-4 flex flex-wrap items-center gap-2 text-sm text-gray-600 dark:text-neutral-400">
                        {% if article.city %}
                            <a href="{{ article.city.get_absolute_url }}"
                               class="inline-flex items-center gap-1.5 rounded-full border border-orange-300 bg-orange-100 px-2.5 py-0.5 text-xs font-medium text-orange-800 hover:bg-orange-200 dark:border-orange-500/40 dark:bg-orange-500/20 dark:text-orange-300 dark:hover:bg-orange-500/30">
                                <svg class="size-3.5 shrink-0" fill="none" stroke="currentColor" stroke-width="1.5" viewBox="0 0 24 24">
                                    <path stroke-linecap="round" stroke-linejoin="round" d="M15 10.5a3 3 0 11-6 0 3 3 0 016 0z" />
                                    <path stroke-linecap="round" stroke-linejoin="round" d="M19.5 10.5c0 7.142-7.5 11.25-7.5 11.25S4.5 17.642 4.5 10.5a7.5 7.5 0 1115 0z" />
                                </svg>
                                {{ article.city.title }}
                            </a>
                        {% endif %}
                        {% if article.tags.exists %}
                            <div class="flex flex-wrap items-center gap-1.5">
                                {% for tag in article.tags.all %}
                                    <a href="{% url 'blog-list-by-tag' tag_slug=tag.slug %}"
                                       class="inline-flex items-center gap-1.5 rounded-full border border-gray-300 bg-gray-100 px-2.5 py-0.5 text-xs font-medium text-gray-700 hover:bg-gray-200 dark:border-neutral-600 dark:bg-neutral-700 dark:text-neutral-300 dark:hover:bg-neutral-600">
                                        <svg class="size-3.5 shrink-0" fill="none" stroke="currentColor" stroke-width="1.5" viewBox="0 0 24 24">
                                            <path stroke-linecap="round" stroke-linejoin="round" d="M12 2H2v10l9.29 9.29c.94.94 2.48.94 3.42 0l6.58-6.58c.94-.94.94-2.48 0-3.42L12 2Z" />
                                            <path stroke-linecap="round" stroke-linejoin="round" d="M7 7h.01" />
                                        </svg>
                                        {{ tag.name }}
                                    </a>
                                {% endfor %}
                            </div>
                        {% endif %}
                    </div>
                    <!-- Краткое содержание -->
                    <div class="content-with-image-gallery text-gray-700 dark:text-neutral-300 [&_h1]:text-xl [&_h1]:font-bold [&_h2]:text-lg [&_h2]:font-semibold [&_p]:mb-2 [&_ul]:list-disc [&_ul]:ml-6 [&_ol]:list-decimal [&_ol]:ml-6 [&_a]:text-blue-600 [&_a]:dark:text-blue-400 [&_a]:hover:underline [&_img]:max-w-full [&_img]:h-auto [&_img]:rounded-lg [&_img]:mb-4 [&_img]:cursor-pointer [&_img]:transition-opacity [&_img]:duration-200 [&_img]:hover:opacity-90">
                        {{ article.content|truncatewords_html:150|safe }}
                    </div>
                    <p class="mt-3">
                        <a href="{% url 'blog-article-detail' slug=article.slug %}"
                           class="text-blue-600 dark:text-blue-400 hover:underline font-medium">
                            Читать далее...
                        </a>
                    </p>

                    <!-- Разделитель -->
                    <hr class="my-4 border-gray-200 dark:border-neutral-700">

                    <!-- Футер: просмотры слева, дата справа -->
                    <footer class="text-sm text-gray-600 dark:text-neutral-400">
                        <div class="flex flex-wrap items-center justify-between gap-2">
                            <div>
                                {% if show_view_stats %}
                                    <span class="inline-flex items-center gap-2 text-gray-500 dark:text-neutral-500" title="Просмотры: всего (авторизованные / гости)">
                                        <span class="inline-flex items-center gap-1">
                                            <svg class="size-3.5 shrink-0" fill="none" stroke="currentColor" stroke-width="1.5" viewBox="0 0 24 24">
                                                <path stroke-linecap="round" stroke-linejoin="round" d="M2.036 12.322a1.012 1.012 0 0 1 0-.639C3.423 7.51 7.36 4.5 12 4.5s8.577 3.007 9.963 7.178c.07.207.07.431 0 .639C20.577 16.49 16.64 19.5 12 19.5s-8.577-3.007-9.963-7.178Z"/>
                                                <path stroke-linecap="round" stroke-linejoin="round" d="M15 12a3 3 0 1 1-6 0 3 3 0 0 1 6 0Z"/>
                                            </svg>
                                            {{ article.view_count_total }} просмотров:
                                        </span>
                                        <span class="inline-flex items-center gap-1.5">
                                            <span class="inline-flex items-center gap-0.5" title="Авторизованные">
                                                <svg class="size-3.5 shrink-0" fill="none" stroke="currentColor" stroke-width="1.5" viewBox="0 0 24 24">
                                                    <path stroke-linecap="round" stroke-linejoin="round" d="M15.75 6a3.75 3.75 0 1 1-7.5 0 3.75 3.75 0 0 1 7.5 0ZM4.501 20.118a7.5 7.5 0 0 1 14.998-0A4.5 4.5 0 0 0 12 18.75c-2.31 0-4.29.813-5.999 2.368Z"/>
                                                </svg>
                                                {{ article.view_count_auth }}
                                            </span>
                                            <span class="text-gray-400 dark:text-neutral-600">/</span>
                                            <span class="inline-flex items-center gap-0.5" title="Гости">
                                                <svg class="size-3.5 shrink-0" fill="none" stroke="currentColor" stroke-width="1.5" viewBox="0 0 24 24">
                                                    <path stroke-linecap="round" stroke-linejoin="round" d="M12 21a9.004 9.004 0 0 0 8.716-6.747M12 21a9.004 9.004 0 0 1-8.716-6.747M12 21c2.485 0 4.5-4.03 4.5-9S14.485 3 12 3m0 18c-2.485 0-4.5-4.03-4.5-9S9.515 3 12 3m0 0a8.997 8.997 0 0 1 7.843 4.582M12 3a8.997 8.997 0 0 0-7.843 4.582m15.686 0A11.953 11.953 0 0 1 12 10.5c-2.998 0-5.74-1.1-7.843-2.918m15.686 0A8.959 8.959 0 0 1 21 12c0 .778-.099 1.533-.284 2.253m0 0A17.919 17.919 0 0 1 12 16.5c-3.162 0-6.133-.815-8.716-2.247m0 0A9.015 9.015 0 0 1 3 12c0-1.605.42-3.113 1.157-4.418"/>
                                                </svg>
                                                {{ article.view_count_guest }}
                                            </span>
                                        </span>
                                    </span>
                                {% endif %}
                            </div>
                            <div>
                                <span class="font-medium">Создано:</span>
                                <span>{{ article.created_at }}</span>
                            </div>
                        </div>
                    </footer>
                </div>
            {% empty %}
                <div class="rounded-xl border border-gray-200 bg-white p-6 shadow-sm dark:border-neutral-700 dark:bg-neutral-900">
                    <div class="text-center text-gray-600 dark:text-neutral-400">
                        На данный момент нет ни одной статьи.
                    </div>
                </div>
            {% endfor %}
        </div>
    </div>

    <!-- Пагинация -->
    {% include 'parts/pagination.html' %}
    <!-- ^^^ Пагинация -->

    {% if not DEBUG %}
        {% include 'advertisement/rtb_feed.html' %}

        {% if not user.is_authenticated %}
            {% include 'advertisement/rtb_floor_ad_mobile.html' %}
            {% include 'advertisement/rtb_floor_ad_desktop.html' %}
        {% endif %}
    {% endif %}
{% endblock %}
