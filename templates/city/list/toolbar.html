{% load morphology %}
{% load vite %}
{% load static %}
{% load filters %}

{% vite_css 'css/autoComplete' %}
{% vite_css 'css/select-field' %}
{% vite_css 'css/components/badge' %}
{% vite_css 'css/components/button' %}
{% vite_css 'css/components/radio' %}
{% vite_css 'css/toolbar' %}

<!-- Панель инструментов -->
<div class="mx-3 my-3 flex flex-wrap items-center gap-3" id="toolbar">
    <!-- Статистика -->
    <div class="toolbar-stats flex flex-wrap items-center gap-3 self-center">
        <div class="hs-tooltip [--placement:top] relative inline-block">
            <span class="hs-tooltip-toggle stat-badge stat-badge-success">
                <span class="stat-badge-dot"></span>
                Всего посещено
                <strong>{{ qty_of_visited_cities }}</strong>
                {{ "города"|plural_by_num:qty_of_visited_cities }}
            </span>
            <span class="hs-tooltip-content" role="tooltip">
                Общее количество городов, которые Вы посетили
            </span>
        </div>

        {% if country_code %}
            <div class="hs-tooltip [--placement:top] relative inline-block">
                <span class="hs-tooltip-toggle stat-badge stat-badge-info">
                    В {{ country_name|prepositional }}:
                    <strong>{{ number_of_visited_cities_in_country }}</strong>
                    из {{ number_of_cities_in_country }}
                </span>
                <span class="hs-tooltip-content" role="tooltip">
                    Количество посещённых городов в выбранной стране
                </span>
            </div>
        {% else %}
            <div class="hs-tooltip [--placement:top] relative inline-block">
                <span class="hs-tooltip-toggle stat-badge stat-badge-info">
                    Стран:
                    <strong>{{ number_of_visited_countries }}</strong>
                </span>
                <span class="hs-tooltip-content" role="tooltip">
                    Количество стран, в которых Вы посещали города
                </span>
            </div>
        {% endif %}
    </div>

    <!-- Поиск -->
    <div class="relative flex-1 min-w-[220px] self-center z-[1049]">
        <input id="city-search"
               type="text"
               class="py-2 px-4 ps-11 block w-full border border-gray-200 rounded-xl bg-white text-sm text-gray-900 focus:border-blue-500 focus:outline-none focus:ring-2 focus:ring-blue-500 dark:border-neutral-700 dark:bg-neutral-900 dark:text-neutral-200 search-input"
               placeholder="Начните вводить название города...">
        </div>

    <!-- Селект страны -->
    <div class="flex-1 min-w-[220px] country-select-wrapper self-center z-[40]">
        <div class="relative">
            <select class="py-2 px-4 pe-9 block w-full border border-gray-200 rounded-xl bg-white text-sm font-medium text-gray-900 focus:border-blue-500 focus:outline-none focus:ring-2 focus:ring-blue-500 dark:border-neutral-700 dark:bg-neutral-900 dark:text-neutral-200"
                    id="id_country"></select>
            <span class="absolute inset-y-0 end-0 flex items-center pe-3 text-gray-400 dark:text-neutral-500 pointer-events-none">
                <i class="fa-solid fa-chevron-down text-xs"></i>
            </span>
        </div>
        </div>

    <!-- Кнопки действий -->
    <div class="toolbar-actions flex flex-wrap items-center gap-3 self-center">
        <div class="hs-tooltip [--placement:top] relative inline-block self-center">
            <a href="{% url 'city-all-map' %}{% if country_code %}?country={{ country_code }}{% endif %}" 
               class="hs-tooltip-toggle inline-flex items-center gap-x-2 rounded-xl border border-emerald-500 px-4 py-2 text-sm font-semibold text-emerald-600 transition hover:bg-emerald-50 focus:outline-none focus:ring-2 focus:ring-emerald-500 focus:ring-offset-2 dark:border-emerald-400 dark:text-emerald-300 dark:hover:bg-emerald-500/10">
                <i class="fa-solid fa-map-location-dot"></i>
                <span>Посмотреть на карте</span>
            </a>
            <span class="hs-tooltip-content" role="tooltip">
                Открыть карту с посещёнными городами
            </span>
        </div>

        <div class="hs-tooltip [--placement:top] relative inline-block self-center">
            <button class="hs-tooltip-toggle relative inline-flex items-center gap-x-2 rounded-xl px-4 py-2 text-sm font-semibold focus:outline-none focus:ring-2 focus:ring-blue-500 focus:ring-offset-2 transition dark:focus:ring-offset-neutral-900 {% if filter is not None or sort is not None and sort != 'last_visit_date_down' %}border border-transparent bg-blue-600 text-white hover:bg-blue-700 dark:bg-blue-500 dark:hover:bg-blue-400{% else %}border border-blue-600 text-blue-600 hover:bg-blue-50 dark:text-blue-400 dark:border-blue-500 dark:hover:bg-blue-500/10{% endif %}"
                    type="button"
                    id="btnOpenFilterSortPanel">
                <i class="fa-solid fa-sliders"></i>
                <span>Фильтры и сортировка</span>
                {% if filter is not None or sort is not None and sort != 'last_visit_date_down' %}
                    <span class="absolute -right-1.5 -top-1.5 inline-flex h-2.5 w-2.5 rounded-full bg-red-500 ring-2 ring-white dark:ring-neutral-900">
                        <span class="sr-only">Применена фильтрация или сортировка</span>
                    </span>
                {% endif %}
            </button>
            <span class="hs-tooltip-content" role="tooltip">
                Открыть панель фильтрации и сортировки городов
            </span>
        </div>
    </div>
</div>
<!-- ^^^ Панель инструментов -->

{% include 'city/list/toolbar/filter_panel.html' %}

{% vite_asset 'js/entries/city_search.js' %}
{% vite_asset 'js/entries/filter_city.js' %}

