{% extends 'head.html' %}
{% load vite %}
{% load static %}

{% block base %}
    {% include 'parts/js_isAuthenticated.html' %}


    <div class="flex">
        {% include 'parts/sidebar.html' %}

        <div class="flex min-h-screen w-full flex-col xl:pl-80" id="section-content">
            <!-- Навбар для маленьких экранов -->
            <nav class="xl:hidden fixed top-0 left-0 right-0 z-[100] border-b border-gray-200 bg-white dark:border-neutral-700 dark:bg-neutral-900">
                <div class="mx-auto max-w-7xl px-4 sm:px-6 lg:px-8">
                    <div class="flex h-16 items-center justify-between">
                        <!-- Кнопка открытия сайдбара -->
                        <button type="button"
                                id="sidebar-toggle"
                                class="relative inline-flex items-center justify-center rounded-lg p-2 text-gray-600 border border-gray-200 hover:bg-gray-100 hover:text-gray-900 hover:border-gray-300 focus:outline-none focus:ring-2 focus:ring-blue-500 dark:text-neutral-400 dark:border-neutral-700 dark:hover:bg-neutral-800 dark:hover:text-neutral-200 dark:hover:border-neutral-600"
                                aria-label="Открыть меню"
                                aria-expanded="false">
                            <svg class="h-6 w-6" fill="none" stroke="currentColor" stroke-width="1.5" viewBox="0 0 24 24" aria-hidden="true">
                                <path stroke-linecap="round" stroke-linejoin="round" d="M3.75 6.75h16.5M3.75 12h16.5m-16.5 5.25h16.5" />
                            </svg>
                            <!-- Уведомление о наличии бейджика с новостями в меню -->
                            {% if has_unread_news %}
                                <span class="absolute -right-1 -top-1 inline-flex h-3 w-3 rounded-full bg-red-500 ring-2 ring-white dark:ring-neutral-900">
                                    <span class="sr-only">Новые уведомления</span>
                                </span>
                            {% endif %}
                        </button>

                        <!-- Логотип -->
                        <a class="absolute left-1/2 -translate-x-1/2 inline-flex items-center gap-3 font-pacifico text-2xl text-gray-900 dark:text-white"
                           href="{% url 'main_page' %}">
                            <span class="leading-none">Мои</span>
                            <span class="inline-flex items-center justify-center w-7 h-7 shrink-0 text-current" aria-hidden="true">
                                <svg xmlns="http://www.w3.org/2000/svg" viewBox="0 0 576 512" class="w-full h-full fill-current">
                                    <path d="M408 120c0 54.6-73.1 151.9-105.2 192c-7.7 9.6-22 9.6-29.6 0C241.1 271.9 168 174.6 168 120C168 53.7 221.7 0 288 0s120 53.7 120 120zm8 80.4c3.5-6.9 6.7-13.8 9.6-20.6c.5-1.2 1-2.5 1.5-3.7l116-46.4C558.9 123.4 576 135 576 152V422.8c0 9.8-6 18.6-15.1 22.3L416 503V200.4zM137.6 138.3c2.4 14.1 7.2 28.3 12.8 41.5c2.9 6.8 6.1 13.7 9.6 20.6V451.8L32.9 502.7C17.1 509 0 497.4 0 480.4V209.6c0-9.8 6-18.6 15.1-22.3l122.6-49zM327.8 332c13.9-17.4 35.7-45.7 56.2-77V504.3L192 449.4V255c20.5 31.3 42.3 59.6 56.2 77c20.5 25.6 59.1 25.6 79.6 0zM288 152a40 40 0 1 0 0-80 40 40 0 1 0 0 80z"/>
                                </svg>
                            </span>
                            <span class="leading-none">города</span>
                        </a>

                        <!-- Кнопка уведомлений -->
                        {% if user.is_authenticated %}
                            <button type="button"
                                    class="relative inline-flex items-center justify-center rounded-lg p-2 text-gray-600 border border-gray-200 hover:bg-gray-100 hover:text-gray-900 hover:border-gray-300 focus:outline-none focus:ring-2 focus:ring-blue-500 dark:text-neutral-400 dark:border-neutral-700 dark:hover:bg-neutral-800 dark:hover:text-neutral-200 dark:hover:border-neutral-600 cursor-pointer"
                                    id="notification_icon"
                                    data-bs-toggle="modal"
                                    data-bs-target="#notificationModal"
                                    aria-label="Открыть уведомления">
                                <svg class="h-6 w-6" fill="none" stroke="currentColor" stroke-width="1.5" viewBox="0 0 24 24" aria-hidden="true" id="bell">
                                    <path stroke-linecap="round" stroke-linejoin="round" d="M14.857 17.082a23.848 23.848 0 005.454-1.31A8.967 8.967 0 0118 9.75v-.7V9A6 6 0 006 9v.75a8.967 8.967 0 01-2.312 6.022c1.733.64 3.56 1.085 5.455 1.31m5.714 0a24.255 24.255 0 01-5.714 0m5.714 0a3 3 0 11-5.714 0" />
                                </svg>
                            </button>
                        {% endif %}
                    </div>
                </div>
            </nav>

            <!-- Отступ для фиксированного навбара на мобильных устройствах -->
            <div class="xl:hidden h-16"></div>

            {% block content %}
            {% endblock %}

            {% include 'parts/footer.html' %}
        </div>
    </div>

    <!-- Overlay backdrop для маленьких экранов -->
    <div id="sidebar-backdrop"
         class="xl:hidden fixed inset-0 z-[1049] bg-gray-900/50 transition-opacity duration-300 opacity-0 pointer-events-none"
         aria-hidden="true"></div>

    {% include 'parts/notification_controls.html' %}
    {% if user.is_authenticated %}
        {% vite_asset 'js/entries/notification.js' %}
    {% endif %}

    {% vite_asset 'js/entries/sidebar.js' %}
    
    {% block modals %}{% endblock %}
{% endblock %}

{% block extra_js %}
    {{ block.super }}
    {% vite_asset 'js/entries/preline.js' %}
{% endblock %}
